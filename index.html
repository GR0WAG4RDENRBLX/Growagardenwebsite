// DupePetsSite.jsx
import { useState, useEffect } from 'react';
import { initializeApp } from 'firebase/app';
import {
  getFirestore, collection, addDoc, getDocs, onSnapshot, deleteDoc, doc
} from 'firebase/firestore';
import {
  getAuth,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from 'firebase/auth';

const firebaseConfig = {
  apiKey: 'YOUR_API_KEY',
  authDomain: 'YOUR_AUTH_DOMAIN',
  projectId: 'YOUR_PROJECT_ID',
  storageBucket: 'YOUR_BUCKET',
  messagingSenderId: 'YOUR_SENDER_ID',
  appId: 'YOUR_APP_ID'
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

export default function DupePetsSite() {
  const [reviewText, setReviewText] = useState('');
  const [reviews, setReviews] = useState([]);
  const [stars, setStars] = useState(5);
  const [user, setUser] = useState(null);

  const reviewsRef = collection(db, 'reviews');

  useEffect(() => {
    const unsub = onSnapshot(reviewsRef, snapshot => {
      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setReviews(data);
    });
    return () => unsub();
  }, []);

  useEffect(() => {
    onAuthStateChanged(auth, setUser);
  }, []);

  const handleSubmit = async () => {
    if (!reviewText.trim()) return;
    await addDoc(reviewsRef, {
      text: reviewText,
      stars,
      timestamp: Date.now()
    });
    setReviewText('');
  };

  const handleLogin = async () => {
    const email = 'tautest_aliens_7f@icloud.com';
    const password = prompt('Enter your admin password:');
    if (password) {
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
        alert(err.message);
      }
    }
  };

  const logout = () => signOut(auth);

  const deleteReview = async (id) => {
    await deleteDoc(doc(db, 'reviews', id));
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-sky-300 to-green-200 text-center p-4 font-sans">
      <h1 className="text-white text-2xl md:text-3xl font-bold mb-2">
        welcome to grow a garden dupe pets ! :)
      </h1>

      {/* Character Mascot Placeholder */}
      <div className="w-48 h-48 mx-auto mb-4 animate-bounce">
        <img
          src="/mascot-placeholder.png"
          alt="dupe mascot"
          className="w-full h-full object-contain"
        />
      </div>

      <p className="text-white text-xl font-semibold">
        this is a cozy little website where we get past the system and dupe your pets!
        <br />100% guaranteed we dupe pets, review list
      </p>

      <div className="bg-white/80 shadow-md rounded p-4 mt-6 max-w-md mx-auto">
        <p className="text-sm mb-2">hi...type a message to know more about me! ^^</p>
        <input
          type="text"
          placeholder="type something..."
          value={reviewText}
          onChange={e => setReviewText(e.target.value)}
          className="w-full border p-2 rounded mb-2"
        />
        <div className="flex justify-between items-center">
          <select
            value={stars}
            onChange={e => setStars(+e.target.value)}
            className="border rounded p-1"
          >
            {[1, 2, 3, 4, 5].map(s => (
              <option key={s} value={s}>{s} ‚≠ê</option>
            ))}
          </select>
          <button onClick={handleSubmit} className="bg-pink-500 hover:bg-pink-600 text-white px-3 py-1 rounded">
            send!
          </button>
        </div>
      </div>

      {/* Latest Reviews */}
      <div className="mt-8 text-left max-w-md mx-auto">
        <h2 className="text-xl font-bold text-yellow-800 mb-2">‚≠ê Latest Reviews</h2>
        {reviews.map(r => (
          <div key={r.id} className="bg-white/90 rounded p-3 mb-2 shadow">
            <p className="text-yellow-600">{'‚≠ê'.repeat(r.stars)}</p>
            <p className="text-black">{r.text}</p>
            {user && (
              <button
                onClick={() => deleteReview(r.id)}
                className="text-red-500 text-sm mt-1"
              >delete</button>
            )}
          </div>
        ))}
      </div>

      {/* Auth Controls */}
      <div className="mt-4">
        {user ? (
          <button onClick={logout} className="text-sm text-gray-700 underline">Log out</button>
        ) : (
          <button onClick={handleLogin} className="text-sm text-blue-700 underline">Admin Login</button>
        )}
      </div>

      {/* Empty Message */}
      {reviews.length === 0 && (
        <div className="mt-6 text-purple-700">no one messaging you blud üíÄ</div>
      )}
    </div>
  );
}
